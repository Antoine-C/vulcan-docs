<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Mutations | Vulcan Docs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="images/favicon.ico" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://docs.vulcanjs.org">
    <meta property="og:title" content="Mutations | Vulcan Docs">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@vulcanjs">
    <meta name="twitter:title" content="Mutations | Vulcan Docs">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />


  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      <a class="logo-wrapper" href="http://docs.vulcanjs.org/" title="Vulcan Documentation Vulcan Documentation"  >
        <img src="/images/vulcan-logo-border-2.svg" alt="Vulcan Documentation" class="logo"/>
        <span>Vulcan Documentation</span>
      </a>
    </div>
  </div>

  <div class="nav-group right">

    <div class="nav-item wrapper-search">
      <div class="input-symbol small round">
        <input type="text" placeholder="Search Vulcan Docs" id="desktop-search-input" />
        <span class="icon-search"></span>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://github.com/vulcanjs/vulcan"  >
          <span>GitHub</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://slack.vulcanjs.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http://docs.vulcanjs.org/" title="Vulcan Documentation"  >
        <span>Vulcan Documentation Vulcan Documentation</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="https://github.com/vulcanjs/vulcan"  >
          <span>GitHub</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://slack.vulcanjs.org"  >
          <span>Slack</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      
    </div>

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>Read Me</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Overview</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="nutshell.html" class="sidebar-link ">
                  <span>Vulcan in a Nutshell</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="architecture.html" class="sidebar-link ">
                  <span>Architecture</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Collections</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="schemas.html" class="sidebar-link ">
                  <span>Schemas & Collections</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="graphql-schema.html" class="sidebar-link ">
                  <span>GraphQL Schema</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="field-resolvers.html" class="sidebar-link ">
                  <span>Field Resolvers</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="schema-properties.html" class="sidebar-link ">
                  <span>Schema Properties</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Data Layer</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="resolvers.html" class="sidebar-link ">
                  <span>Resolvers</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="fragments.html" class="sidebar-link ">
                  <span>Fragments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="terms-parameters.html" class="sidebar-link ">
                  <span>Terms & Parameters</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="server-queries.html" class="sidebar-link ">
                  <span>Querying on the Server</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="security.html" class="sidebar-link ">
                  <span>Security</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="performance.html" class="sidebar-link ">
                  <span>Performance</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="database.html" class="sidebar-link ">
                  <span>Database Layer</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="connecting-remotely.html" class="sidebar-link ">
                  <span>Connecting Remotely</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">API</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="theming.html" class="sidebar-link ">
                  <span>Components & Theming</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="core-components.html" class="sidebar-link ">
                  <span>Core Components</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="ui-components.html" class="sidebar-link ">
                  <span>UI Components</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="callbacks.html" class="sidebar-link ">
                  <span>Callbacks</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="users.html" class="sidebar-link ">
                  <span>Users</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="groups-permissions.html" class="sidebar-link ">
                  <span>Groups & Permissions</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="routing.html" class="sidebar-link ">
                  <span>Routing</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="internationalization.html" class="sidebar-link ">
                  <span>Internationalization</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="head-tags.html" class="sidebar-link ">
                  <span>Head Tags</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="errors.html" class="sidebar-link ">
                  <span>Errors & Messages</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="settings.html" class="sidebar-link ">
                  <span>Settings</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Forms</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="forms.html" class="sidebar-link ">
                  <span>Forms</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="forms-components.html" class="sidebar-link ">
                  <span>Form Components</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="forms-custom.html" class="sidebar-link ">
                  <span>Custom Form Components</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Packages</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="packages.html" class="sidebar-link ">
                  <span>Packages Types</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="email.html" class="sidebar-link ">
                  <span>Email</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="newsletter.html" class="sidebar-link ">
                  <span>Newsletter</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="payments.html" class="sidebar-link ">
                  <span>Payments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="admin.html" class="sidebar-link ">
                  <span>Admin Dashboard</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="embed.html" class="sidebar-link ">
                  <span>Embed</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="cloudinary.html" class="sidebar-link ">
                  <span>Cloudinary</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="voting.html" class="sidebar-link ">
                  <span>Voting</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="events.html" class="sidebar-link ">
                  <span>Analytics & Event Tracking</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="forms-upload.html" class="sidebar-link ">
                  <span>Upload Package</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="debug.html" class="sidebar-link ">
                  <span>Debugging</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Tutorials</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="example-simple.html" class="sidebar-link ">
                  <span>Simple Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-movies.html" class="sidebar-link ">
                  <span>Movies Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-instagram.html" class="sidebar-link ">
                  <span>Instagram Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-forum.html" class="sidebar-link ">
                  <span>Forum Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-customization.html" class="sidebar-link ">
                  <span>Customization Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-permissions.html" class="sidebar-link ">
                  <span>Permissions Example</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="sponsorship-tutorial.html" class="sidebar-link ">
                  <span>Sponsorship Flow Tutorial</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="deployment.html" class="sidebar-link ">
                  <span>Deployment Guide</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="recipes.html" class="sidebar-link ">
                  <span>Recipes</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Resources</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="learn.html" class="sidebar-link ">
                  <span>Learn More</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="examples.html" class="sidebar-link ">
                  <span>Examples</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="common-problems.html" class="sidebar-link ">
                  <span>Common Problems</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="plugins.html" class="sidebar-link ">
                  <span>Plugins</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="themes.html" class="sidebar-link ">
                  <span>Themes</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="tutorials.html" class="sidebar-link ">
                  <span>Tutorials</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="videos.html" class="sidebar-link ">
                  <span>Videos</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Mutations</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/vulcanjs/vulcan-docs/tree/master/source/mutations.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <p>A mutation is very similar to a query. It receives a GraphQL request, decides what to do with it, and then returns some data. But because mutations can result in <em>changes</em> to your data, they have their own special <code>Mutation</code> type to differentiate them.</p>
<h2 id="Mutation-Steps"><a href="#Mutation-Steps" class="headerlink" title="Mutation Steps"></a>Mutation Steps</h2><p>When talking about mutations, it’s important to distinguish between the different elements that make up the overall process. For example, let’s imagine that a user submits a form for creating a new document. </p>
<ol>
<li>First, this will <strong>trigger a request</strong> to your GraphQL endpoint, sent by Apollo Client. You can do this either by writing your own mutation higher-order component, or by using one of Vulcan’s <a href="#Mutation-Higher-Order-Components">pre-made mutation HoCs</a>. </li>
<li>When the GraphQL endpoint receives this request, it will look for a corresponding <strong>mutation resolver</strong>. Again you can either code your own resolver, or use Vulcan’s <a href="#Default-Mutation-Resolvers">default mutations</a>.</li>
<li>The mutation resolver then calls a <strong>mutator</strong>. The mutator is the function that does the actual job of validating the request and mutating your data. The reason for this additional layer is that you’ll often want to mutate data for <em>outside</em> your GraphQL API. By extracting that logic you’re able to call the same exact mutator function whether you’re inserting a new document sent by the front-end or, say, seeding your database with content extracted from an API. As usual, Vulcan offers a set of <a href="#Default-Mutators">default mutators</a>.</li>
<li>Finally, the mutator calls a <a href="/database.html#Connectors">database connector</a> to perform the actual database operation. By abstracting out the database operation, we’re able to make mutators (and by extension your entire GraphQL API) database-agnostic. This means that you can switch from MongoDB to MySQL without having to modify any of the above three layers. </li>
</ol>
<h2 id="Mutation-Higher-Order-Components"><a href="#Mutation-Higher-Order-Components" class="headerlink" title="Mutation Higher-Order Components"></a>Mutation Higher-Order Components</h2><p>Vulcan includes three main default higher-order components to make calliing mutations from your React components easier. Note that when using the <a href="forms.html">Forms</a> module, all three mutation HoCs are automatically added for you.</p>
<h4 id="withCreate"><a href="#withCreate" class="headerlink" title="withCreate"></a><code>withCreate</code></h4><p>This HoC takes the following two options:</p>
<ul>
<li><code>collection</code>: the collection to operate on.</li>
<li><code>fragment</code>: specifies the data to ask for as a return value.</li>
</ul>
<p>And passes on a <code>createMovie</code> (or <code>createPost</code>, <code>createUser</code>, etc.) function to the wrapped component, which takes a single <code>document</code> argument.</p>
<p>Takes an object as argument with a single <code>data</code> property and returns a promise:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.props</span><br><span class="line">  .createMovie(&#123; data &#125;)</span><br><span class="line">  .then(<span class="comment">/* success */</span>)</span><br><span class="line">  .catch(<span class="comment">/* error */</span>);</span><br></pre></td></tr></table></figure>
<h4 id="withUpdate"><a href="#withUpdate" class="headerlink" title="withUpdate"></a><code>withUpdate</code></h4><p>Same options as <code>withCreate</code>. The returned <code>updateMovie</code> mutation takes three arguments: <code>documentId</code>, <code>set</code>, and <code>unset</code>.</p>
<p>Takes an object with two properties as an argument and returns a promise:</p>
<ul>
<li><code>selector</code>: a selector pointing to the document to modify. Usually <code>{ documentId }</code>.</li>
<li><code>data</code>: the fields to modify or delete (as a list of field name/value pairs with deleted fields set to <code>null</code>, e.g.<code>{title: &#39;My New Title&#39;, body: &#39;My new body&#39;, status: null}</code>).</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.props</span><br><span class="line">  .updateMovie(&#123;</span><br><span class="line">    selector: &#123; documentId &#125;,</span><br><span class="line">    data,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="comment">/* success */</span>)</span><br><span class="line">  .catch(<span class="comment">/* error */</span>);</span><br></pre></td></tr></table></figure>
<h4 id="withDelete"><a href="#withDelete" class="headerlink" title="withDelete"></a><code>withDelete</code></h4><p>A single <code>collection</code> option. The returned <code>deleteMovie</code> mutation takes a single <code>selector</code> argument.</p>
<p>Takes an object with a single <code>selector</code> property as an argument and returns a promise.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.props</span><br><span class="line">  .removeMutation(&#123;</span><br><span class="line">    selector: &#123; documentId &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="comment">/* success */</span>)</span><br><span class="line">  .catch(<span class="comment">/* error */</span>);</span><br></pre></td></tr></table></figure>
<h4 id="withMutation"><a href="#withMutation" class="headerlink" title="withMutation"></a><code>withMutation</code></h4><p>In addition to the three main mutation HoCs, The <code>withMutation</code> HoC provides an easy way to call a specific mutation on the server by letting you create ad-hoc mutation containers.</p>
<p>It takes two options:</p>
<ul>
<li><code>name</code>: the name of the mutation to call on the server (will also be the name of the prop passed to the component).</li>
<li><code>args</code>: (optional) an object containing the mutation’s arguments and types.</li>
</ul>
<p>For example, here’s how to wrap the <code>MyComponent</code> component to pass it an <code>addEmailNewsletter</code> function as prop:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mutationOptions = &#123;</span><br><span class="line">  name: <span class="string">'addEmailNewsletter'</span>,</span><br><span class="line">  args: &#123; <span class="attr">email</span>: <span class="string">'String'</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line">withMutation(mutationOptions)(MyComponent);</span><br></pre></td></tr></table></figure>
<p>You would then call the function with:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">this</span><span class="selector-class">.props</span><span class="selector-class">.addEmailNewsletter</span>(&#123;<span class="attribute">email</span>: <span class="string">'foo@bar.com'</span>&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Mutations-Resolvers"><a href="#Mutations-Resolvers" class="headerlink" title="Mutations Resolvers"></a>Mutations Resolvers</h2><p>When creating a new collection, <code>createCollection</code> accepts a <code>mutations</code> object. This object should include three mutations, <code>new</code>, <code>edit</code>, and <code>remove</code>, each of which has the following properties:</p>
<ul>
<li><code>name</code>: the name of the mutation.</li>
<li><code>check</code>: a function that takes the current user and (optionally) the document being operated on, and return <code>true</code> or <code>false</code> based on whether the user can perform the operation.</li>
<li><code>mutation</code>: the mutation function.</li>
</ul>
<h3 id="Default-Mutation-Resolvers"><a href="#Default-Mutation-Resolvers" class="headerlink" title="Default Mutation Resolvers"></a>Default Mutation Resolvers</h3><p>Vulcan provides a set of default New, Edit and Remove mutations you can use to save time:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createCollection,</span><br><span class="line">  getDefaultResolvers,</span><br><span class="line">  getDefaultMutations</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"><span class="keyword">import</span> schema <span class="keyword">from</span> <span class="string">'./schema.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Movies = createCollection(&#123;</span><br><span class="line">  typeName: <span class="string">'Movie'</span>,</span><br><span class="line"></span><br><span class="line">  schema,</span><br><span class="line"></span><br><span class="line">  resolvers: getDefaultResolvers(options),</span><br><span class="line"></span><br><span class="line">  mutations: getDefaultMutations(options)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<p>The <code>options</code> object can have the following properties: </p>
<ul>
<li><code>typeName</code> (String): the resolver’s type name (required).</li>
<li><code>create</code> (Boolean): whether to create a <code>create</code> mutation (defaults to <code>true</code>).</li>
<li><code>update</code> (Boolean): whether to create a <code>update</code> mutation (defaults to <code>true</code>).</li>
<li><code>upsert</code> (Boolean): whether to create a <code>upsert</code> mutation (defaults to <code>true</code>).</li>
<li><code>delete</code> (Boolean): whether to create a <code>delete</code> mutation (defaults to <code>true</code>).</li>
<li><code>createCheck</code> (Function): a function used to customize the <code>create</code> check.</li>
<li><code>updateCheck</code> (Function): a function used to customize the <code>update</code> check.</li>
<li><code>upsertCheck</code> (Function): a function used to customize the <code>upsert</code> check.</li>
<li><code>deleteCheck</code> (Function): a function used to customize the <code>delete</code> check.</li>
</ul>
<p>Vulcan’s default mutations are fairly lightweight. For example here’s the body of the <code>edit</code> mutation resolver (where <code>collectionName</code> is <code>getDefaultMutations</code>‘s argument):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> mutation(root, &#123;documentId, set, unset&#125;, context) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> collection = context[collectionName];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get entire unmodified document from database</span></span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">document</span> = <span class="keyword">await</span> Connectors.get(collection, documentId);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// check if user can perform operation; if not throw error</span></span><br><span class="line">  Utils.performCheck(<span class="keyword">this</span>.check, context.currentUser, <span class="built_in">document</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// call updateMutator boilerplate function</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> updateMutator(&#123;</span><br><span class="line">    collection, </span><br><span class="line">    selector, </span><br><span class="line">    data, </span><br><span class="line">    currentUser: context.currentUser,</span><br><span class="line">    validate: <span class="literal">true</span>,</span><br><span class="line">    context,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>To learn more about what exactly the default mutations do, you can <a href="https://github.com/VulcanJS/Vulcan/blob/devel/packages/vulcan-core/lib/modules/default_mutations.js" target="_blank" rel="noopener">find their code here</a>.</p>
<h3 id="Custom-Mutations"><a href="#Custom-Mutations" class="headerlink" title="Custom Mutations"></a>Custom Mutations</h3><p>You can also add your own mutations resolvers using <code>addGraphQLMutation</code> and <code>addGraphQLResolvers</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; addGraphQLMutation, addGraphQLResolvers &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line">addGraphQLMutation(</span><br><span class="line">  <span class="string">'postsVote(documentId: String, voteType: String) : Post'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> voteResolver = &#123;</span><br><span class="line">  Mutation: &#123;</span><br><span class="line">    postsVote(root, &#123; documentId, voteType &#125;, context) &#123;</span><br><span class="line">      <span class="comment">// do mutation</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">addGraphQLResolvers(voteResolver);</span><br></pre></td></tr></table></figure>
<h2 id="Mutators"><a href="#Mutators" class="headerlink" title="Mutators"></a>Mutators</h2><p>A <strong>mutator</strong> is the function that actually does the work of mutating data on the server. As opposed to the <em>mutation</em>, which is usually a fairly light function called directly through the GraphQL API, a <em>mutator</em> will take care of the heavy lifting, including validation, callbacks, etc., and should be written in such a way that it can be called from anywhere: a GraphQL API, a REST API, from the server directly, etc.</p>
<h3 id="Default-Mutators"><a href="#Default-Mutators" class="headerlink" title="Default Mutators"></a>Default Mutators</h3><p>Vulcan features three standard mutators: <code>createMutator</code>, <code>updateMutator</code>, and <code>deleteMutator</code>. They are in essence thin wrappers around the standard Mongo <code>insert</code>, <code>update</code>, and <code>remove</code>.</p>
<p>These mutation functions should be defined <em>outside</em> your GraphQL mutation resolvers, so that you’re able to call them from outside a GraphQL context (for example, to seed your database through a server script).</p>
<p>They take the following arguments:</p>
<ul>
<li><code>collection</code>: the collection affected.</li>
<li><code>document</code>: the document to mutate.</li>
<li><code>data</code>: (<code>updateMutator</code> only) the mutation payload.</li>
<li><code>currentUser</code>: the user performing the operation.</li>
<li><code>validate</code>: whether to validate the operation based on the current user.</li>
<li><code>context</code>: the resolver context.</li>
</ul>
<p>If <code>validate</code> is set to <code>true</code>, these boilerplate operations will:</p>
<ul>
<li>Check that the current user has permission to insert/edit each field.</li>
<li>Validate the document against collection schema.</li>
<li>Add <code>userId</code> to document (insert only).</li>
<li>Run any validation callbacks (e.g. <code>movies.new.validate</code>).</li>
</ul>
<p>They will then run the mutation’s document (or the <code>set</code> modifier) through the collection’s sync callbacks (e.g. <code>movie.create.sync</code>), perform the operation, and finally run the async callbacks (e.g. <code>movie.create.async</code>).</p>
<p>For example, here is the <code>Posts</code> collection’s <code>create</code> mutation resolver, using the <code>createMutator</code> boilerplate mutation:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createMutator &#125; <span class="keyword">from</span> <span class="string">'meteor/vulcan:core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="keyword">new</span>: &#123;</span><br><span class="line">    name: <span class="string">'createPost'</span>,</span><br><span class="line"></span><br><span class="line">    check(user, <span class="built_in">document</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!user) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> Users.canDo(user, <span class="string">'post.create'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    mutation(root, &#123; <span class="built_in">document</span> &#125;, context) &#123;</span><br><span class="line">      performCheck(<span class="keyword">this</span>.check, context.currentUser, <span class="built_in">document</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> createMutator(&#123;</span><br><span class="line">        collection: context.Posts,</span><br><span class="line">        <span class="built_in">document</span>: <span class="built_in">document</span>,</span><br><span class="line">        currentUser: context.currentUser,</span><br><span class="line">        validate: <span class="literal">true</span>,</span><br><span class="line">        context</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Mutator-Callbacks"><a href="#Mutator-Callbacks" class="headerlink" title="Mutator Callbacks"></a>Mutator Callbacks</h3><p>Default mutators create the following callback hooks for every collection: </p>
<ul>
<li><code>typename.operation.validate</code>: called to validate the document or modifier. </li>
<li><code>typename.operation.before</code>: called before the database operation.</li>
<li><code>typename.operation.after</code>: called after the database operation, but before the mutator returns.</li>
<li><code>typename.operation.async</code>: called in an async manner after the mutator returns. </li>
</ul>
<p>You can learn more about callbacks in the <a href="callbacks.html">Callbacks</a> section.</p>
<h3 id="Custom-Mutators"><a href="#Custom-Mutators" class="headerlink" title="Custom Mutators"></a>Custom Mutators</h3><p>If you’re writing your own resolvers you can of course also write your own mutators, either by using Vulcan’s <a href="/database.html#Connectors">Connectors</a> or even by accessing your database directly. </p>
<p>One thing to be aware of though is that by doing this you’ll bypass any callback hooks used by the default mutators, and you’ll also have to take care of your own data validation. </p>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="resolvers.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Resolvers
        </a>
      
      
        <a class="link primary next"
          href="fragments.html">
          <span class="subtitle-pagination">Next</span>
          Fragments
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/vulcanjs/vulcan-docs/tree/master/source/mutations.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

    <script src="/script/smooth-scroll.min.js"></script>
    <script src="/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>


    <script>
      
    </script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
    <script type="text/javascript"> docsearch({
      apiKey: 'ab091fbd89cda3abd54a35c4441b3e9b',
      indexName: 'vulcanjs',
      inputSelector: '#desktop-search-input',
      debug: true // Set debug to true if you want to inspect the dropdown
    });
    </script>

  </body>
</html>
